package %%PACKAGENAME%%;

%%IMPORTS%%

import org.kxml2.kdom.Element;

public class %%CLASSNAME%% {
    public String Address;
    public boolean IsDotNet = true;

    public boolean Debug = false;

    public Element[] Headers;
    public Marshal[] Marshals;

    public %%CLASSNAME%%() {
        Marshals = new Marshal[]{ new MarshalBase64() };
    }

    protected SoapSerializationEnvelope newEnvelope() {
        SoapSerializationEnvelope envelope = new SoapSerializationEnvelope(getSoapVersion());
        envelope.dotNet = IsDotNet;
        envelope.headerOut = Headers;
        for (Marshal item : Marshals) { item.register(envelope); }
        return envelope;
    }

    protected int getSoapVersion(){
        return SoapEnvelope.VER11;
    }

    protected Object transport(String action, SoapSerializationEnvelope envelope) throws Exception {
        HttpTransportSE transport = new HttpTransportSE(Address);
        transport.debug = Debug;
        try {
            transport.call(action, envelope);
        }
        catch (Exception ex) { throw ex; }
        finally {
            if (transport.debug) {
                System.err.println(transport.requestDump);
                System.err.println(transport.responseDump);
            }
        }
        return envelope.bodyIn;
    }
    

    public Object call(Object request, SoapObject soapParams, String soapActon,
                Class<?> responseClass) throws Exception {
        SoapSerializationEnvelope envelope = newEnvelope();
        envelope.setOutputSoapObject(soapParams);
        responseClass.getMethod("register", SoapSerializationEnvelope.class)
            .invoke(responseClass.newInstance(),envelope);
        return transport(soapActon, envelope);
    }

%%METHODS%%

}
